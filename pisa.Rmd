---
title: "PISA 2012"
author: "Liping Huang"
date: "2/1/2019"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(magrittr)
library(knitr)
library(data.table)
library(ggplot2)
library(PISA2012lite) 
library(dplyr)
library(GGally)
library(gbm)
```

# Analytics

```{r,echo=F}

student_2012 <- select(student2012, "PV1MATH","PV2MATH","PV3MATH", "PV4MATH","PV5MATH", "STIDSTD", "STRATUM","CNT")

stu_2012 <- cbind(student_2012, pvmath = rowSums(student_2012[,1:5])/5)

#' PA07Q01 - Household Income
#' PA08Q01 - Education cost
#' PA13Q01 - With-child - Wellbeing at school
#' PA13Q03 - With-child - talking
#' PARINVOL - Parent involvement
#' PARSUPP  - Student support
#' PQBFMJ - Father ISEI from parent questionnaire
#' PQBMMJ - Mother ISEI from parent questionnaire
#' PQFISCED - PQ Educational level of father
#' PQMISCED - PQ Educational level of mother
#' PQHISCED - PQ Higest educational level of parent
#' PQHISEI - PQ Higest Parental occupation status
par_stu_2012 <-merge(stu_2012, parent2012, by = c("STRATUM", "STIDSTD","CNT"))
setDT(par_stu_2012)
```

Basically, I select plausible values in mathematics in student2012 along with the keys, including student identification("STIDSTD") and the stratum identification("STRATUM"), followed by merging student subset datasets and parent datasets for further analytics.

## Parent Education

As mentioned before, parent education may influence the student performance. Let's plot the math value by father's educational level, mother's educational level and the highest education level of parents and find some interesting insights first.

```{r}
#select the PQ Higest educational level of father and pvmath
fisced_stu_2012 <- select(par_stu_2012,"PQFISCED", pvmath)
fisced_stu_2012_long <- melt(fisced_stu_2012[PQFISCED!="NA",], id.vars = "PQFISCED")
fisced_plot <- ggplot(fisced_stu_2012_long, aes(x=variable, y= value, fill = factor(PQFISCED))) + geom_boxplot()

#select the PQ Higest educational level of mother and pvmath
misced_stu_2012 <- select(par_stu_2012,"PQMISCED", pvmath)
misced_stu_2012_long <- melt(misced_stu_2012[PQMISCED!="NA",], id.vars = "PQMISCED")
misced_plot <- ggplot(misced_stu_2012_long, aes(x=variable, y= value, fill = factor(PQMISCED))) + geom_boxplot() 

#select the PQ Higest educational level of parent and pvmath
isced_stu_2012 <- select(par_stu_2012,"PQHISCED", pvmath)
isced_stu_2012_long <- melt(isced_stu_2012[PQHISCED!="NA",], id.vars = "PQHISCED")
hisced_plot <- ggplot(isced_stu_2012_long, aes(x=variable, y= value, fill = factor(PQHISCED))) + geom_boxplot()

cowplot::plot_grid(fisced_plot, misced_plot, hisced_plot)
```

## Household Income


Similarly, let's have a data exploration with the household and student plausible value.

```{r}
#select the household income and pvmath
income_stu_2012 <- select(par_stu_2012,"PA07Q01", pvmath)
# transform the data into long data to further analysis

income_stu_2012_long <- melt(income_stu_2012[PA07Q01!="NA",], id.vars = "PA07Q01")
ggplot(income_stu_2012_long, aes(x=variable, y= value, fill = factor(PA07Q01))) + geom_boxplot() + labs(x = "Househould income", y = "plausiable value in mathematics", title = "Plausiable value in mathematics by Household Income")
```
